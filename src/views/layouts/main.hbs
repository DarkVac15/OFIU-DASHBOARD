<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFIU</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400,300' rel='stylesheet' type='text/css'>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body class="{{bodyClass}} bg-dark text-light bg-light text-dark">
    {{#if showNavbar}}
    {{> navbar}} <!-- Mostrar el navbar solo si showNavbar es true -->
    {{/if}}

   


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        type="text/javascript"></script>


    <!-- Aquí va el script de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

        import { getStorage   } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDvl7JxrYoAkUzdQz7NRLsirctc0wBw79E",
            authDomain: "prueba2-3e291.firebaseapp.com",
            projectId: "prueba2-3e291",
            storageBucket: "prueba2-3e291.appspot.com",
            messagingSenderId: "1026858531766",
            appId: "1:1026858531766:web:be5217b5c6111f3885df17",

        };
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const auth = getAuth(app);
         
// Exponer el storage y auth globalmente
        window.firebaseStorage = storage;
        window.firebaseAuth = auth;


        async function login(email, password) {

            // Iniciar sesión en Firebase y obtener el token
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const idToken = await userCredential.user.getIdToken();
            // Imprimir el token en consola
            console.log(idToken);
            // Enviar el token al servidor usando fetch

            window.location.href = '/dashboard';

        }

        document.getElementById('loginButton')?.addEventListener('click', function () {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            login(email, password);
        });

        async function logout() {
            try {
                await signOut(auth);
                console.log('Usuario ha cerrado sesión');
                window.location.href = '/';
            } catch (error) {
                console.error('Error al cerrar sesión:', error);
            }
        }

        document.getElementById('logoutButton')?.addEventListener('click', logout);
    </script>
 {{{body}}}
</body>

</html>